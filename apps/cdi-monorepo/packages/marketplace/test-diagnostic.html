<!DOCTYPE html>
<html>
<head>
    <title>Quick AI & Store Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Marketplace Diagnostic Test</h1>
    
    <div class="test">
        <h2>Test 1: API Key Check</h2>
        <button onclick="testAPIKey()">Check API Key</button>
        <div id="apiResult"></div>
    </div>

    <div class="test">
        <h2>Test 2: AI Response Test</h2>
        <button onclick="testAI()">Test AI</button>
        <div id="aiResult"></div>
    </div>

    <div class="test">
        <h2>Test 3: Store Listings Test</h2>
        <button onclick="testStore()">Check Store Data</button>
        <div id="storeResult"></div>
    </div>

    <script>
        const API_KEY = 'AQ.Ab8RN6LssOzoD7XtzFDeTaXQvPuU0jgIOpK4Ou9kbYLfbpgNmA';
        const SUPABASE_URL = 'https://nwpyfryrhrocvzxtfxxc.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53cHlmcnlyaHJvY3Z6eHRmeHhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NjEyMDgsImV4cCI6MjA3NjEzNzIwOH0.m5yIr0ZJLkb1Bj1VSFA9u95cLZNCy3A7YcFJ-KFpMcU';

        async function testAPIKey() {
            const result = document.getElementById('apiResult');
            result.innerHTML = '<p>Checking API key...</p>';
            
            if (!API_KEY || API_KEY.includes('PASTE')) {
                result.innerHTML = '<p class="error">‚ùå API Key not configured!</p>';
                return;
            }
            
            result.innerHTML = `<p class="success">‚úÖ API Key present: ${API_KEY.substring(0, 15)}...</p>`;
        }

        async function testAI() {
            const result = document.getElementById('aiResult');
            result.innerHTML = '<p>Testing AI connection...</p>';
            
            try {
                const response = await fetch(
                    `https://aiplatform.googleapis.com/v1/publishers/google/models/gemini-2.5-flash-lite:streamGenerateContent?key=${API_KEY}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                role: 'user',
                                parts: [{ text: 'Say "AI is working!"' }]
                            }]
                        })
                    }
                );

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`API Error: ${response.status} - ${error}`);
                }

                const data = await response.json();
                
                if (Array.isArray(data)) {
                    const text = data.map(chunk => 
                        chunk.candidates?.[0]?.content?.parts?.[0]?.text || ''
                    ).join('');
                    
                    result.innerHTML = `
                        <p class="success">‚úÖ AI is working!</p>
                        <p><strong>Response:</strong> ${text}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    throw new Error('Unexpected response format');
                }
            } catch (error) {
                result.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        async function testStore() {
            const result = document.getElementById('storeResult');
            result.innerHTML = '<p>Checking store listings...</p>';
            
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/listings?select=id,title,listing_type,status,stock_quantity&listing_type=eq.store&status=eq.active`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );

                const data = await response.json();
                
                result.innerHTML = `
                    <p class="success">‚úÖ Found ${data.length} store listings</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>